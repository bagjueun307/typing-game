<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì™€ê¸€ì™€ê¸€ íƒ€ìì™• ë°°í‹€! V40</title>
    <link href="https://fonts.googleapis.com/css2?family=DungGeunMo&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --red: #ff4757; --blue: #2e86de; --yellow: #ffa502; --dark: #2f3542; }
        body { background: #5758bb; color: #fff; font-family: 'DungGeunMo', sans-serif; margin: 0; overflow: hidden; }
        
        #lobby { position: fixed; inset: 0; background: #5758bb; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .start-btn { padding: 20px 60px; font-size: 2.5rem; background: var(--yellow); border: 8px outset #eccc68; cursor: pointer; border-radius: 20px; font-family: 'DungGeunMo'; }
        
        #top-bar { position: fixed; top: 0; left: 0; right: 0; height: 70px; background: #fff; border-bottom: 5px solid var(--dark); display: flex; justify-content: space-around; align-items: center; z-index: 900; color: var(--dark); }
        #timer-disp { font-size: 2.5rem; color: var(--red); background: var(--dark); padding: 5px 20px; border-radius: 10px; }
        
        /* ì¤‘ì•™ í„´ ì•Œë¦¼ì°½ */
        #turn-indicator { position: fixed; top: 80px; left: 50%; transform: translateX(-50%); z-index: 850; padding: 10px 40px; border-radius: 0 0 20px 20px; font-size: 2rem; font-weight: bold; border: 4px solid var(--dark); border-top: none; }
        .turn-red-label { background: var(--red); color: #fff; }
        .turn-blue-label { background: var(--blue); color: #fff; }

        #room-view { display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; width: 100vw; height: 100vh; gap: 20px; padding: 130px 20px 20px; box-sizing: border-box; }
        
        /* ëª¨ë‹ˆí„° ìŠ¤íƒ€ì¼ */
        .monitor { border: 8px solid var(--dark); background: #fff; border-radius: 25px; display: flex; flex-direction: column; position: relative; overflow: hidden; transition: 0.3s; }
        
        /* íŒ€ë³„ ê³ ìœ  ìƒ‰ìƒ ê°•ì¡° (í„´ì¼ ë•Œë§Œ ë‚˜íƒ€ë‚¨) */
        .monitor.team-red.active { border-color: var(--red); box-shadow: 0 0 40px var(--red); background: #fff1f1; }
        .monitor.team-blue.active { border-color: var(--blue); box-shadow: 0 0 40px var(--blue); background: #f0f8ff; }

        /* ëª¨ë‹ˆí„° ë‚´ë¶€ ìƒë‹¨ ë¼ë²¨ */
        .mon-label { padding: 5px; text-align: center; font-size: 1.2rem; background: #ddd; color: #333; }
        .active .mon-label { color: #fff; animation: blink 0.6s infinite; }
        .team-red.active .mon-label { background: var(--red); }
        .team-blue.active .mon-label { background: var(--blue); }

        .board { display: grid; grid-template-columns: repeat(8, 1fr); gap: 8px; flex: 1; padding: 15px; }
        .card-container { height: 40px; perspective: 600px; }
        .card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.4s; transform-style: preserve-3d; }
        .is-flipped .card-inner { transform: rotateY(180deg); }
        .card-front, .card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; border: 2px solid var(--dark); }
        .card-front { background: white; color: black; }
        .card-back { transform: rotateY(180deg); color: white; }
        .back-red { background: var(--red); }
        .back-blue { background: var(--blue); }

        .input-box { width: 100%; padding: 15px; font-family: 'DungGeunMo'; font-size: 1.8rem; border: none; border-top: 4px solid var(--dark); text-align: center; outline: none; }
        .active .input-box { background: #fff; }
        .inactive-input { background: #eee !important; color: #999; }

        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .focused { border-width: 12px !important; transform: scale(1.02); z-index: 500; }
    </style>
</head>
<body id="game-body">

<div id="lobby">
    <h1 style="font-size: 3.5rem;">ğŸ® íŒ€ ëŒ€í•­ íƒ€ì ë°°í‹€ ğŸ®</h1>
    <button class="start-btn" onclick="triggerStart()">ê²Œì„ ì‹œì‘</button>
</div>

<div id="top-bar">
    <div style="color:var(--red); font-size: 2rem; font-weight: bold;">RED TEAM: <span id="total-red">0</span></div>
    <div id="timer-disp">120.0s</div>
    <div style="color:var(--blue); font-size: 2rem; font-weight: bold;">BLUE TEAM: <span id="total-blue">0</span></div>
</div>

<div id="turn-indicator" class="turn-red-label">ë¹¨ê°„ íŒ€ ê³µê²©!</div>

<div id="room-view">
    <div class="monitor team-red" id="mon-1">
        <div class="mon-label">RED PLAYER 1</div>
        <div class="board" id="board-1"></div>
        <input type="text" id="input-1" class="input-box" onkeydown="handleInput(event, 'red', 1)" placeholder="ëŒ€ê¸° ì¤‘">
    </div>
    <div class="monitor team-blue" id="mon-2">
        <div class="mon-label">BLUE PLAYER 1</div>
        <div class="board" id="board-2"></div>
        <input type="text" id="input-2" class="input-box" onkeydown="handleInput(event, 'blue', 2)" placeholder="ëŒ€ê¸° ì¤‘">
    </div>
    <div class="monitor team-red" id="mon-3">
        <div class="mon-label">RED PLAYER 2</div>
        <div class="board" id="board-3"></div>
        <input type="text" id="input-3" class="input-box" onkeydown="handleInput(event, 'red', 3)" placeholder="ëŒ€ê¸° ì¤‘">
    </div>
    <div class="monitor team-blue" id="mon-4">
        <div class="mon-label">BLUE PLAYER 2</div>
        <div class="board" id="board-4"></div>
        <input type="text" id="input-4" class="input-box" onkeydown="handleInput(event, 'blue', 4)" placeholder="ëŒ€ê¸° ì¤‘">
    </div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://play1-d0379-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref('game_v40');

    const words = ["ë–¡ë³¶ì´", "ê¸‰ì‹", "ìš´ë™ì¥", "ë°©í•™", "ì•Œë¦¼ì¥", "ì§ê¿", "ì¤€ë¹„ë¬¼", "ì‹¤ë‚´í™”", "ë”±ì§€", "ìŠ¬ëŸ¬ì‹œ", "í”¼ì¹´ì¸„", "í•™ì›", "ìˆ™ì œ", "ì²´ìœ¡", "ì†Œí’", "ì‰¬ëŠ”ì‹œê°„", "ì§€ìš°ê°œ", "í•„í†µ", "ë¦¬ì½”ë”", "ë°˜ì¥", "ì¼ê¸°", "ë…ì„œ", "í”¼êµ¬", "íƒœê¶Œë„", "ë¬¸ë°©êµ¬", "êµì‹¤", "ë§¤ì ", "ì¹ íŒ", "ë¶„í•„", "ì •ë¬¸", "êµê°€", "í˜„ì¥í•™ìŠµ", "ê°œí•™", "êµì¥ì‹¤", "ê³¼í•™ì‹¤", "ìŒì•…ì‹¤", "ë³µë„", "ì‹¤ë‚´í™”ê°€ë°©", "ë°›ì•„ì“°ê¸°", "ë°©ê³¼í›„"];
    let turn = 'red', hasStarted = false;

    // ì´ˆê¸° ì¹´ë“œ ìƒì„±
    for(let i=1; i<=4; i++){
        const board = document.getElementById(`board-${i}`);
        words.forEach(w => {
            const card = document.createElement('div');
            card.className = 'card-container'; card.id = `card-${i}-${w}`;
            card.innerHTML = `<div class="card-inner"><div class="card-front">${w}</div><div class="card-back" id="back-${i}-${w}">${w}</div></div>`;
            board.appendChild(card);
        });
    }

    db.on('value', snap => {
        const d = snap.val(); if(!d) return;
        if(d.state==='START' && !hasStarted) { hasStarted=true; document.getElementById('lobby').style.display='none'; gameLoop(); }
        
        words.forEach(w => {
            const owner = d.cards?.[w]?.team;
            for(let i=1; i<=4; i++){
                const c = document.getElementById(`card-${i}-${w}`);
                const b = document.getElementById(`back-${i}-${w}`);
                if(owner) { 
                    c.classList.add('is-flipped'); 
                    b.className = `card-back back-${owner}`;
                } else { c.classList.remove('is-flipped'); }
            }
        });
        document.getElementById('total-red').innerText = Object.values(d.cards||{}).filter(v=>v.team==='red').length;
        document.getElementById('total-blue').innerText = Object.values(d.cards||{}).filter(v=>v.team==='blue').length;
    });

    function triggerStart() { db.set({ state: 'START', cards: {} }); }

    function handleInput(e, team, id) {
        if(e.key === 'Enter') {
            const val = e.target.value.trim();
            if(team === turn && words.includes(val)) {
                db.child('cards').child(val).set({ team: team, t: Date.now() });
            }
            e.target.value = '';
        }
    }

    function gameLoop() {
        let time = 1200;
        const ind = document.getElementById('turn-indicator');
        setInterval(() => {
            if(time > 0) {
                time--;
                document.getElementById('timer-disp').innerText = (time/10).toFixed(1) + "s";
                turn = (Math.floor((1200-time)/100) % 2 === 0) ? 'red' : 'blue';

                // í„´ ì•Œë¦¼ì°½ ì—…ë°ì´íŠ¸
                ind.innerText = turn === 'red' ? "ğŸ”´ ë¹¨ê°„ íŒ€ ê³µê²©!" : "ğŸ”µ íŒŒë€ íŒ€ ê³µê²©!";
                ind.className = turn === 'red' ? "turn-red-label" : "turn-blue-label";

                // ê° ëª¨ë‹ˆí„° ìƒíƒœ ì—…ë°ì´íŠ¸
                for(let i=1; i<=4; i++){
                    const mon = document.getElementById(`mon-${i}`);
                    const inp = document.getElementById(`input-${i}`);
                    const myTeam = (i % 2 === 1) ? 'red' : 'blue';

                    if(myTeam === turn) {
                        mon.classList.add('active');
                        inp.classList.remove('inactive-input');
                        inp.placeholder = "ë‹¨ì–´ ì…ë ¥!!";
                    } else {
                        mon.classList.remove('active');
                        inp.classList.add('inactive-input');
                        inp.placeholder = "ì ì‹œ ëŒ€ê¸°";
                    }
                }
            }
        }, 100);
    }
</script>
</body>
</html>
