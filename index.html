<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>íƒ€ì ë°°í‹€ V88 - ëŒ€ê´´ë„: ì„¸ìƒ í›”ì¹˜ê¸°</title>
    <link href="https://fonts.googleapis.com/css2?family=DungGeunMo&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --red: #FF4757; --blue: #2E86DE; --yellow: #FECA57; --dark: #1E272E; --bg: #0F0F1B; --neon-red: #FF0000; }
        body { background: var(--bg); color: #fff; font-family: 'DungGeunMo', sans-serif; margin: 0; overflow: hidden; }
        
        /* ìƒë‹¨ ë°”: ì „ë¦¬í’ˆ í˜„í™© */
        #top-bar { position: fixed; top: 0; left: 0; right: 0; height: 70px; background: #222; border-bottom: 5px solid var(--yellow); display: flex; justify-content: space-around; align-items: center; z-index: 6000; }
        #timer-disp { font-size: 2.2rem; color: var(--yellow); text-shadow: 0 0 10px var(--yellow); }

        /* ì„ ìƒë‹˜ -> ê°ì‹œì(ë³´ì•ˆ ì‹œìŠ¤í…œ) */
        .teacher-box { text-align: center; padding: 10px; background: #333; color: #eee; border-bottom: 3px solid #000; font-size: 1.2rem; }
        .teacher-box.watching { 
            background: var(--neon-red) !important; 
            color: #fff !important; 
            font-size: 1.8rem !important; 
            animation: alert-flash 0.3s infinite alternate;
        }
        @keyframes alert-flash { from { opacity: 1; } to { opacity: 0.6; } }

        /* ë¼ìš´ë“œ ì„ íƒ: ì‘ì „ëª… */
        #round-selector { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .round-btn { width: 400px; padding: 18px; margin: 8px; font-size: 1.4rem; cursor: pointer; border: 4px solid var(--yellow); background: transparent; color: var(--yellow); font-family:'DungGeunMo'; border-radius: 10px; }
        .round-btn:hover { background: var(--yellow); color: #000; }

        /* ë¹„ë°€ ì°½ê³ (ê±°ì‹¤) */
        #lounge-overlay { position: fixed; inset: 0; background: #000; z-index: 5500; display: none; grid-template-columns: 1fr 1fr; gap: 20px; padding: 100px 30px 30px 30px; box-sizing: border-box; }
        .lounge-display { border: 5px dashed var(--yellow); border-radius: 20px; display: flex; flex-wrap: wrap; align-content: flex-start; padding: 30px; gap: 15px; }
        .lounge-label { width: 100%; font-size: 2rem; text-align: center; color: var(--yellow); margin-bottom: 20px; border-bottom: 2px solid var(--yellow); padding-bottom: 10px; }

        /* ì „íˆ¬ í™”ë©´ */
        #room-view { display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 15px; padding: 15px; height: 100vh; box-sizing: border-box; padding-top: 105px; }
        .monitor { border: 5px solid #444; background: #1a1a1a; display: flex; flex-direction: column; border-radius: 15px; overflow: hidden; position: relative; }
        .monitor.focused { z-index: 3500; position: fixed !important; inset: 120px 30px 30px 30px; border-color: var(--yellow); box-shadow: 0 0 50px rgba(254, 202, 87, 0.5); }

        .board { display: grid; grid-template-columns: repeat(10, 1fr); gap: 5px; flex: 1; padding: 10px; background: #111; }
        .card-container { height: 45px; perspective: 500px; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .is-flipped .card-inner { transform: rotateY(180deg); }
        .card-front, .card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border: 1px solid #333; display: flex; align-items: center; justify-content: center; border-radius: 5px; font-size: 0.7rem; }
        .card-front { background: #222; color: #666; } /* ì•„ì§ ì•ˆ í›”ì¹œ ë¬¼ê±´: í¬ë¯¸í•¨ */
        .card-back { transform: rotateY(180deg); color: white; font-weight: bold; border: 2px solid #fff; }
        .back-red { background: linear-gradient(45deg, var(--red), #b33939); box-shadow: 0 0 10px var(--red); }
        .back-blue { background: linear-gradient(45deg, var(--blue), #227093); box-shadow: 0 0 10px var(--blue); }

        .input-wrapper { display: flex; height: 60px; background: #000; border-top: 3px solid var(--yellow); }
        .input-box { flex: 1; background: transparent; color: var(--yellow); border: none; font-family: 'DungGeunMo'; font-size: 1.8rem; text-align: center; outline: none; }
        .input-box::placeholder { color: #444; font-size: 1rem; }

        .start-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; }
        .start-btn { padding: 20px 40px; font-size: 2rem; background: transparent; color: var(--yellow); border: 3px solid var(--yellow); cursor: pointer; font-family: 'DungGeunMo'; }
        #countdown-layer { position: fixed; inset: 0; background: #000; z-index: 9000; display: none; align-items: center; justify-content: center; font-size: 12rem; color: var(--yellow); }
    </style>
</head>
<body>

<div id="countdown-layer">ì¹¨íˆ¬ ê°œì‹œ...</div>

<div id="round-selector">
    <h1 style="color:var(--yellow); font-size: 3rem; margin-bottom: 20px; letter-spacing: 5px;">[ WORLD STEALER ]</h1>
    <p style="color:#888; margin-bottom: 30px;">ì„¸ìƒì˜ ë‹¨ì–´ë¥¼ ì…ë ¥í•´ ë‹¹ì‹ ì˜ ì°½ê³ ë¡œ ì „ì†¡í•˜ì‹­ì‹œì˜¤.</p>
    <button class="round-btn" onclick="selectRound(1)">ì‘ì „ 1: ì¼ìƒ ìš©í’ˆ íƒˆì·¨</button>
    <button class="round-btn" onclick="selectRound(2)">ì‘ì „ 2: ì´ëª¨ì§€ ì½”ë“œ í•´í‚¹</button>
    <button class="round-btn" onclick="selectRound(3)">ì‘ì „ 3: êµ­ê°€ ê¸°ë°€ ë³´ì•ˆ(í•˜ë“œ)</button>
    <button class="round-btn" onclick="selectRound(4)" style="border-style: double; font-weight: bold;">ğŸ”¥ ë¬´í•œ ìŸíƒˆì „: ì „ë¦¬í’ˆ ëºê¸°</button>
</div>

<div id="top-bar">
    <div style="color:var(--red);">RED ì°½ê³ : <span id="total-red">0</span></div>
    <button style="background:none; border:1px solid var(--yellow); color:var(--yellow); padding:5px 15px; cursor:pointer; font-family:'DungGeunMo';" onclick="toggleLounge()">ğŸ’ ì°½ê³  í™•ì¸</button>
    <div id="timer-disp">ì‘ì „ ì‹œê°„: 60.0</div>
    <div style="color:var(--blue);">BLUE ì°½ê³ : <span id="total-blue">0</span></div>
</div>

<div id="main-container">
    <div id="lounge-overlay">
        <div class="lounge-display" id="red-lounge-view"><div class="lounge-label">RED SECRET VAULT</div></div>
        <div class="lounge-display" id="blue-lounge-view"><div class="lounge-label">BLUE SECRET VAULT</div></div>
    </div>
    
    <div id="room-view">
        <script>
            for(let i=1; i<=4; i++) {
                document.write(`
                    <div class="monitor" id="mon-${i}" onclick="focusMon(${i})">
                        <div id="overlay-${i}" class="start-overlay">
                            <h2 style="color:var(--yellow); margin-bottom:15px;">AGENT ${i}</h2>
                            <button class="start-btn" onclick="requestStart(event)">ğŸ•µï¸ ì¹¨íˆ¬ ì‹œì‘</button>
                        </div>
                        <div class="teacher-box" id="teach-${i}">ğŸ“¡ ë³´ì•ˆ ì‹œìŠ¤í…œ ìš°íšŒ ì¤‘...</div>
                        <div class="board" id="board-${i}"></div>
                        <div class="input-wrapper">
                            <input type="text" id="input-${i}" class="input-box" onkeydown="handleInput(event, ${i})" placeholder="ë¬¼ê±´ ì´ë¦„ì„ ì…ë ¥í•´ í›”ì¹˜ì„¸ìš”..." disabled>
                        </div>
                    </div>
                `);
            }
        </script>
    </div>
</div>

<script>
    const allWords = [
        {t:"ì‚¬ê³¼",i:"ğŸ"},{t:"í¬ë„",i:"ğŸ‡"},{t:"í”¼ì",i:"ğŸ•"},{t:"ì¶•êµ¬",i:"âš½"},{t:"í•™êµ",i:"ğŸ«"},{t:"ì—°í•„",i:"âœï¸"},{t:"ìë™ì°¨",i:"ğŸš—"},{t:"íƒœì–‘",i:"â˜€ï¸"},{t:"êµ¬ë¦„",i:"â˜ï¸"},{t:"ê²Œì„",i:"ğŸ®"},{t:"ì‹œê³„",i:"â°"},{t:"ê·¸ë¦¼",i:"ğŸ¨"},{t:"ë‚˜ë¬´",i:"ğŸŒ³"},{t:"ì˜ì",i:"ğŸª‘"},{t:"ë…¸íŠ¸",i:"ğŸ““"},{t:"ê¸°ì°¨",i:"ğŸš‚"},{t:"ìš°ì‚°",i:"â˜‚ï¸"},{t:"ì•ˆê²½",i:"ğŸ‘“"},{t:"ë…¸ë˜",i:"ğŸ¤"},{t:"ë°”ë‹¤",i:"ğŸŒŠ"},{t:"ì†Œê¸ˆ",i:"ğŸ§‚"},{t:"ìš°ìœ ",i:"ğŸ¥›"},{t:"ë¼ë©´",i:"ğŸœ"},{t:"ëª¨ì",i:"ğŸ§¢"},{t:"ì¥ê°‘",i:"ğŸ§¤"},{t:"ì˜¤ì´",i:"ğŸ¥’"},{t:"ë‚˜ë¹„",i:"ğŸ¦‹"},{t:"ê³ ë˜",i:"ğŸ³"},{t:"ì—¬ìš°",i:"ğŸ¦Š"},{t:"í’ì„ ",i:"ğŸˆ"},
        {t:"ì»´í“¨í„°",i:"ğŸ’»"},{t:"í…”ë ˆë¹„ì „",i:"ğŸ“º"},{t:"ìŠ¤ë§ˆíŠ¸í°",i:"ğŸ“±"},{t:"ë–¡ë³¶ì´",i:"ğŸ¥˜"},{t:"í–„ë²„ê±°",i:"ğŸ”"},{t:"ì„ ìƒë‹˜",i:"ğŸ‘¨â€ğŸ«"},{t:"ëŒ€í•œë¯¼êµ­",i:"ğŸ‡°ğŸ‡·"},{t:"ì•„ì´ìŠ¤í¬ë¦¼",i:"ğŸ¦"},{t:"ìŠ¤ì¼€ì´íŠ¸",i:"â›¸ï¸"},{t:"ìì „ê±°",i:"ğŸš²"},{t:"ë¹„í–‰ê¸°",i:"âœˆï¸"},{t:"ì†Œë°©ì°¨",i:"ğŸš’"},{t:"ê²½ì°°ì°¨",i:"ğŸš“"},{t:"ë¬´ì§€ê°œ",i:"ğŸŒˆ"},{t:"ì½”ë¼ë¦¬",i:"ğŸ˜"},{t:"ê³ êµ¬ë§ˆ",i:"ğŸ "},{t:"ì„ ê¸€ë¼ìŠ¤",i:"ğŸ•¶ï¸"},{t:"í¬ë¦¬ìŠ¤ë§ˆìŠ¤",i:"ğŸ„"},{t:"ìƒŒë“œìœ„ì¹˜",i:"ğŸ¥ª"},{t:"ë„ì„œê´€",i:"ğŸ“š"},{t:"ì˜¤ë Œì§€",i:"ğŸŠ"},{t:"ë°”ë‚˜ë‚˜",i:"ğŸŒ"},{t:"ë‹¤ëŒì¥",i:"ğŸ¿ï¸"},{t:"ì§€í•˜ì‹¤",i:"ğŸšï¸"},{t:"í”„ë¼ì´íŒ¬",i:"ğŸ³"},{t:"ìœ ì¹˜ì›",i:"ğŸ“›"},{t:"ë¨¸ë¦¬ì¹´ë½",i:"ğŸ’‡"},{t:"ì²´ìœ¡ê´€",i:"ğŸŸï¸"},{t:"ì„ í’ê¸°",i:"ğŸ"},{t:"ëƒ‰ì¥ê³ ",i:"ğŸ§Š"}
    ];

    let wordSet = [], monTeams = {}, hasStarted = false, isWatching = false, loungeMode = false, currentRound = 1;
    const db = firebase.initializeApp({ databaseURL: "https://play1-d0379-default-rtdb.firebaseio.com/" }).database().ref('game_v88');

    async function selectRound(r) {
        currentRound = r;
        wordSet = (r === 3) ? allWords.slice(30) : allWords.slice(0, 30);
        await db.set({ state: 'WAITING', cards: {}, teams: {1:'red', 2:'blue', 3:'red', 4:'blue'} });
        document.getElementById('round-selector').style.display = 'none';
        initBoard();
    }

    function initBoard() {
        for(let i=1; i<=4; i++){
            const b = document.getElementById(`board-${i}`); b.innerHTML = "";
            wordSet.forEach(item => {
                const c = document.createElement('div'); c.className = 'card-container'; c.id = `card-${i}-${item.t}`;
                c.innerHTML = `<div class="card-inner"><div class="card-front"><span>${item.i}</span></div><div class="card-back" id="back-${i}-${item.t}">${item.t}</div></div>`;
                b.appendChild(c);
            });
        }
    }

    db.on('value', snap => {
        const d = snap.val(); if(!d) return;
        if(d.state === 'START' && !hasStarted) {
            document.querySelectorAll('.start-overlay').forEach(ov => ov.style.display = 'none');
            startCountDown();
        }
        if(d.teams) {
            monTeams = d.teams;
            for(let i=1; i<=4; i++) {
                const team = d.teams[i];
                const m = document.getElementById(`mon-${i}`);
                m.className = `monitor team-${team} ${m.classList.contains('focused')?'focused':''}`;
            }
        }
        let redEmojis = [], blueEmojis = [];
        if(d.cards) {
            Object.keys(d.cards).forEach(word => {
                const team = d.cards[word].team;
                const emojiObj = allWords.find(w => w.t === word);
                if(emojiObj) { team === 'red' ? redEmojis.push(emojiObj.i) : blueEmojis.push(emojiObj.i); }
                for(let i=1; i<=4; i++){
                    const c = document.getElementById(`card-${i}-${word}`), b = document.getElementById(`back-${i}-${word}`);
                    if(c) { c.classList.add('is-flipped'); if(b) b.className = `card-back back-${team}`; }
                }
            });
        }
        updateLoungeUI('red', redEmojis); updateLoungeUI('blue', blueEmojis);
        document.getElementById('total-red').innerText = redEmojis.length;
        document.getElementById('total-blue').innerText = blueEmojis.length;
    });

    function updateLoungeUI(team, emojis) {
        const l = document.getElementById(`${team}-lounge-view`), label = l.querySelector('.lounge-label');
        l.innerHTML = ''; l.appendChild(label);
        emojis.forEach(e => { const span = document.createElement('span'); span.style.fontSize='4.5rem'; span.innerText = e; l.appendChild(span); });
    }

    function toggleLounge() {
        loungeMode = !loungeMode;
        document.getElementById('lounge-overlay').style.display = loungeMode ? 'grid' : 'none';
    }

    function focusMon(id) {
        if(hasStarted || loungeMode) return;
        document.querySelectorAll('.monitor').forEach(m => m.classList.remove('focused'));
        document.getElementById(`mon-${id}`).classList.add('focused');
    }

    function requestStart(e) { e.stopPropagation(); db.update({ state: 'START' }); }

    function startCountDown() {
        hasStarted = true;
        const layer = document.getElementById('countdown-layer');
        layer.style.display = 'flex';
        let count = 3;
        const messages = ["ì¥ë¹„ ì ê²€...", "ë³´ì•ˆ ë¬´ë ¥í™” ì¤‘...", "ì¹¨íˆ¬ 1ì´ˆ ì „!", "ì§€ê¸ˆì…ë‹ˆë‹¤!"];
        const itv = setInterval(() => {
            layer.innerText = count >= 0 ? messages[3-count] : "";
            if(count < 0) {
                clearInterval(itv);
                layer.style.display = 'none';
                document.querySelectorAll('.input-box').forEach(i=>i.disabled=false);
                const focused = document.querySelector('.monitor.focused');
                if(focused) focused.querySelector('.input-box').focus();
                gameLoop();
            }
            count--;
        }, 1000);
    }

    function handleInput(e, id) {
        if(e.key === 'Enter') {
            const val = e.target.value.trim();
            const myTeam = monTeams[id];
            if(isWatching) {
                db.child('cards').once('value', s => {
                    const c = s.val(); if(!c) return;
                    let mine = Object.keys(c).filter(k => c[k].team === myTeam);
                    if(mine.length) db.child('cards').child(mine[mine.length-1]).remove();
                });
            } else if(wordSet.some(w => w.t === val)) {
                db.child('cards').child(val).once('value', s => {
                    if(currentRound === 4 || !s.exists()) {
                        db.child('cards').child(val).set({ team: myTeam });
                    }
                });
            }
            e.target.value = '';
        }
    }

    function gameLoop() {
        let time = 600;
        setInterval(() => {
            if(time <= 0) return; time--;
            document.getElementById('timer-disp').innerText = "ì¹¨íˆ¬ ì‹œê°„: " + (time/10).toFixed(1);
            isWatching = ((600-time)%200 >= 170);
            for(let i=1; i<=4; i++){
                const t = document.getElementById(`teach-${i}`);
                if(isWatching) {
                    t.innerText = "ğŸš¨ ê²½ë³´ ë°œë ¹!! ë©ˆì¶”ì‹­ì‹œì˜¤! ğŸš¨";
                    t.classList.add('watching');
                } else {
                    t.innerText = "ğŸ“¡ ë³´ì•ˆ ì‹œìŠ¤í…œ ìš°íšŒ ì¤‘... (ì•ˆì „)";
                    t.classList.remove('watching');
                }
            }
        }, 100);
    }
</script>
</body>
</html>
